<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Electron Configuration — Class/Test Mode</title>

  <style>
    :root {
      --bg:#0f1216; --fg:#e6eaf0; --mut:#a8b0bd;
      --accent:#5aa7ff; --s:#1f6d3a; --p:#0e6b73;
      --d:#5c1135; --f:#143ea9;
      --panel:#0b111b; --edge:#273244; --orb:#0f1622;
      --warn:#ef4444; --ok:#22c55e;
    }
    * { box-sizing:border-box; }
    html,body {
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family:system-ui,Arial,sans-serif;
    }
    .wrap { max-width:1400px; margin:0 auto; padding:16px; }
    h1 { font-size:18px; margin:0 0 10px; }

    /* Buttons and badges */
    .btn {
      background:#142030;
      color:#e7eefc;
      border:1px solid #2b3a55;
      border-radius:8px;
      padding:4px 10px;
      cursor:pointer;
    }
    .btn:hover { background:#1d2a40; }
    .btn.warn { background:#3a1612; border-color:#702d23; color:#ffbbb0; }
    .btn.primary { background:#003366; border-color:#2266cc; color:#dff1ff; }
    .badge {
      border:1px solid #2b3a55;
      border-radius:10px;
      padding:4px 8px;
      background:#0f1622;
      color:#dce6f4;
    }
    .hint { font-size:12px; color:var(--mut); }
    .hidden { display:none; }

    /* Panels / layout */
    .panel {
      border:1px solid var(--edge);
      border-radius:12px;
      background:var(--panel);
    }
    .panel .inner { padding:12px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    /* Orbital blocks */
    .blocks {
      display:grid;
      grid-template-columns:auto 1fr 1fr 1fr 1fr;
      gap:14px;
      align-items:start;
    }
    .blabel { display:flex; align-items:center; gap:8px; }
    .bl {
      width:28px; height:28px; border-radius:6px;
      display:flex; align-items:center; justify-content:center;
      font-weight:700; color:#fff;
    }
    .sbg { background:var(--s); }
    .pbg { background:var(--p); }
    .dbg { background:var(--d); }
    .fbg { background:var(--f); }
    .block { display:grid; gap:8px; }
    .rowline { display:flex; align-items:center; gap:10px; }
    .rlabel { width:28px; text-align:right; opacity:.85; }
    .orbitals { display:flex; gap:8px; }
    .orbital {
      width:42px; height:34px;
      border:2px solid #5a6b86;
      border-radius:8px;
      background:var(--orb);
      display:flex; align-items:center; justify-content:center;
    }
    .orbital.full { border-color:var(--ok); }
    .orbital.over { outline:2px dashed var(--accent); }

    /* Electrons */
    .e {
      width:18px; height:18px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:14px; user-select:none;
    }
    .up {
      background:#1f6d3a; border:1px solid #3dd17b; color:#c6f7da;
    }
    .down {
      background:#7a2c21; border:1px solid #ff9c8a; color:#ffeae7;
    }

    /* Floating tray */
    .workspace { position:relative; }
    .float-tray {
      position:absolute; right:12px; bottom:12px; z-index:3;
      backdrop-filter:saturate(1.2) blur(6px);
      background:rgba(16,22,33,.86);
      border:1px solid #2b3a55; border-radius:14px;
      box-shadow:0 10px 24px rgba(0,0,0,.35);
      padding:10px 12px; color:#dbe7ff; max-width:420px;
    }
    .float-tray .top { display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
    .float-tray .arrows { display:flex; gap:8px; }
    .float-tray .e { cursor:grab; }
    @media (max-width:720px) {
      .float-tray {
        left:50%; right:auto; transform:translateX(-50%);
        bottom:8px; max-width:92%;
      }
    }

    /* Periodic tables */
    .pt-grid { display:grid; grid-template-columns:repeat(18,32px); gap:4px; align-items:start; }
    .pt-btn {
      width:32px; height:32px; border-radius:6px;
      border:1px solid #2b3a55; background:#0e1726;
      color:#dbe7ff; font-size:12px; display:flex;
      align-items:center; justify-content:center; cursor:pointer;
    }
    .pt-btn:hover { outline:2px solid #3a82ff; }
    .pt-blank { visibility:hidden; }
    .pt-mini { grid-template-columns:repeat(18,24px); gap:3px; }
    .pt-mini .pt-btn { width:24px; height:24px; font-size:10px; pointer-events:none; }
    .pt-mini .pt-btn:hover { outline:none; }
    .pt-hi { outline:2px solid #5aa7ff !important; box-shadow:0 0 0 2px rgba(90,167,255,.25); }
    .pt-s { background:var(--s) !important; }
    .pt-p { background:var(--p) !important; }
    .pt-d { background:var(--d) !important; }
    .pt-f { background:var(--f) !important; }

    /* Teacher panel */
    #teacherPanel { margin-top:16px; }
    .tp-wrap { display:grid; grid-template-columns:1.2fr 1fr; gap:16px; }
    @media (max-width:1000px){ .tp-wrap { grid-template-columns:1fr; } }
    .queue { display:flex; flex-direction:column; gap:8px; }
    .queue-item {
      display:flex; align-items:center; gap:8px;
      border:1px solid #2b3a55; border-radius:10px;
      padding:6px 8px; background:#0e1726; flex-wrap:wrap;
    }
    .chip { padding:.1rem .45rem; border:1px solid #2b3a55; border-radius:999px; background:#132034; }
    #classTotals strong { font-weight:700; }
  </style>
</head>
<body>
<div class="wrap workspace">

  <h1>Electron Configuration Trainer / Class Mode</h1>

  <!-- Firebase / Auth initialization -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    // === FIREBASE CONFIG (embedded from LiveGauge standard) ===
    const firebaseConfig = {
      apiKey: "AIzaSyBTD9D-1R6rnhb5wC1C9Cq9QOAxg3XoX7A",
      authDomain: "livegauge-chem.firebaseapp.com",
      databaseURL: "https://livegauge-chem-default-rtdb.firebaseio.com",
      projectId: "livegauge-chem",
      storageBucket: "livegauge-chem.appspot.com",
      messagingSenderId: "783311250711",
      appId: "1:783311250711:web:91f7605c899a432c81d3e7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // === GLOBAL STATE ===
    let currentUser = null;
    let isTeacher = false;
    let classKey = "";
    let studentName = "";
    let studentScore = 0;
    let totalPossible = 0;
    let testQueue = [];
    let currentItemIndex = 0;

    const EXCEPTIONS = {
      24: {'4s':1,'3d':5}, // Chromium
      29: {'4s':1,'3d':10} // Copper
    };

    // === ELEMENT MAP (partial for brevity; will auto-fill later) ===
    const ELEMENTS = {
      1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",
      11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",
      19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",
      27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",
      35:"Br",36:"Kr"
    };

    // === Firebase utilities ===
    function classRef(path="") {
      return db.ref("classes/"+classKey+(path?"/"+path:""));
    }

    function updateRoster(name,score){
      if(!classKey||!name)return;
      classRef("roster/"+name).set({score:score||0,ts:Date.now()});
    }

    function loadRoster(){
      classRef("roster").on("value",snap=>{
        const val=snap.val()||{};
        const list=Object.entries(val).map(([n,v])=>({n,score:v.score||0}));
        renderRoster(list);
      });
    }

    function renderRoster(list){
      const div=document.getElementById("studentList");
      div.innerHTML="";
      let tot=0;
      list.forEach(r=>{
        tot+=r.score||0;
        const e=document.createElement("div");
        e.textContent=`${r.n}: ${r.score}`;
        div.appendChild(e);
      });
      document.getElementById("classTotals").textContent=
        `Total: ${tot} pts  |  Avg: ${(tot/list.length||0).toFixed(1)}`;
    }

    // === Authentication ===
    function signInAnon(){
      auth.signInAnonymously()
        .then(()=>console.log("Signed in anonymously"))
        .catch(e=>alert("Auth error: "+e.message));
    }

    auth.onAuthStateChanged(u=>{
      currentUser=u;
      if(u) console.log("Auth ready",u.uid);
    });

    // === TEACHER PORTAL ===
    function setClass(){
      const val=document.getElementById("classInput").value.trim();
      if(!val){alert("Enter class name");return;}
      classKey=val.replace(/[^a-zA-Z0-9_-]/g,"").toLowerCase();
      localStorage.setItem("classKey",classKey);
      document.getElementById("classLabel").textContent=classKey;
      classRef("meta").set({ts:Date.now()});
      loadRoster();
      alert("Class set: "+classKey);
    }

    function closeClass(){
      if(!classKey)return;
      if(!confirm("End this class and clear all data?"))return;
      classRef().remove();
      document.getElementById("studentList").innerHTML="";
      document.getElementById("classTotals").textContent="";
      alert("Class closed.");
    }

    // === STUDENT JOIN ===
    function joinClass(){
      const val=document.getElementById("joinClassInput").value.trim();
      const name=document.getElementById("studentNameInput").value.trim();
      if(!val||!name){alert("Enter class and name");return;}
      classKey=val.toLowerCase();
      studentName=name;
      localStorage.setItem("studentName",name);
      localStorage.setItem("classKey",classKey);
      document.getElementById("joinArea").classList.add("hidden");
      document.getElementById("trainerArea").classList.remove("hidden");
      updateRoster(name,0);
      alert("Joined "+classKey+" as "+name);
    }

    // === SCORING ===
    function adjustScore(delta){
      studentScore+=delta;
      if(studentScore<0)studentScore=0;
      updateRoster(studentName,studentScore);
      document.getElementById("studentScore").textContent=studentScore;
    }

    // === ORBITAL BUILDING (simplified) ===
    const ORBITAL_ORDER=["1s","2s","2p","3s","3p","4s","3d","4p","5s","4d","5p","6s","4f","5d","6p","7s"];
    let filled={};

    function resetBoard(){
      filled={};
      document.querySelectorAll(".orbital").forEach(o=>o.classList.remove("full"));
    }

    function autoPlaceOne(){
      for(let o of ORBITAL_ORDER){
        if(!(o in filled))filled[o]=0;
        const max=(o.includes("s")?2:o.includes("p")?6:o.includes("d")?10:14);
        if(filled[o]<max){
          filled[o]++;
          if(filled[o]==max)document.querySelector(`[data-orb="${o}"]`)?.classList.add("full");
          break;
        }
      }
      updateConfigOutput();
    }

    function autoRemoveOne(){
      for(let i=ORBITAL_ORDER.length-1;i>=0;i--){
        const o=ORBITAL_ORDER[i];
        if(filled[o]>0){filled[o]--;document.querySelector(`[data-orb="${o}"]`)?.classList.remove("full");break;}
      }
      updateConfigOutput();
    }

    // === DISPLAY CONFIGURATION ===
    function updateConfigOutput(){
      let text="";
      for(let o of ORBITAL_ORDER){
        const n=filled[o]||0;
        if(n>0)text+=`${o}<sup>${n}</sup> `;
      }
      document.getElementById("configText").innerHTML=text.trim();
    }

    // === INIT ===
    window.addEventListener("load",()=>{
      signInAnon();
      classKey=localStorage.getItem("classKey")||"";
      studentName=localStorage.getItem("studentName")||"";
      if(classKey&&studentName){
        document.getElementById("joinArea").classList.add("hidden");
        document.getElementById("trainerArea").classList.remove("hidden");
        loadRoster();
        updateRoster(studentName,studentScore);
      }
    });
  </script>
  <!-- === JOIN / TRAINER AREA === -->
  <div id="joinArea" class="panel inner">
    <h2>Join a Class</h2>
    <div class="row">
      <input id="joinClassInput" placeholder="Class name">
      <input id="studentNameInput" placeholder="Your name">
      <button class="btn primary" onclick="joinClass()">Join</button>
    </div>
  </div>

  <div id="trainerArea" class="panel inner hidden">
    <h2>Electron Config Practice</h2>
    <div class="row">
      <span class="badge">Class: <span id="classLabel"></span></span>
      <span class="badge">Student: <span id="studentName"></span></span>
      <span class="badge">Score: <span id="studentScore">0</span></span>
    </div>

    <!-- Orbital chart -->
    <div id="orbitalChart" class="blocks" style="margin-top:12px">
      <div class="blabel"><div class="bl sbg">s</div></div>
      <div class="blabel"><div class="bl pbg">p</div></div>
      <div class="blabel"><div class="bl dbg">d</div></div>
      <div class="blabel"><div class="bl fbg">f</div></div>
      <div class="block" id="orbGrid"></div>
    </div>

    <div style="margin-top:8px">
      <button class="btn" onclick="autoPlaceOne()">Auto-place 1 electron</button>
      <button class="btn" onclick="autoRemoveOne()">Auto-remove 1</button>
      <button class="btn warn" onclick="resetBoard()">Reset</button>
    </div>

    <p id="configText" style="margin-top:10px;font-family:monospace;"></p>

    <!-- Periodic chart -->
    <h3>Periodic Chart</h3>
    <div id="ptable" class="pt-grid"></div>
  </div>

  <!-- === TEACHER PANEL === -->
  <div id="teacherPanel" class="panel inner">
    <h2>Teacher Controls</h2>
    <div class="row">
      <input id="classInput" placeholder="Set class name">
      <button class="btn primary" onclick="setClass()">Set Class</button>
      <button class="btn warn" onclick="closeClass()">Close Class</button>
    </div>

    <div id="teacherQueue" style="margin-top:12px">
      <h3>Student Roster</h3>
      <div id="studentList" class="queue"></div>
      <div id="classTotals" style="margin-top:8px;font-weight:700;"></div>
    </div>
  </div>

  <!-- === FLOATING ELECTRON TRAY === -->
  <div class="float-tray" id="tray">
    <div class="top">
      <div class="arrows">
        <div class="e up" draggable="true">↑</div>
        <div class="e down" draggable="true">↓</div>
      </div>
    </div>
  </div>

<script>
/* ===== Build Orbital grid ===== */
function buildOrbitals(){
  const grid=document.getElementById("orbGrid");
  grid.innerHTML="";
  ORBITAL_ORDER.forEach(o=>{
    const div=document.createElement("div");
    div.className="orbital";
    div.dataset.orb=o;
    div.ondragover=(e)=>{e.preventDefault();div.classList.add("over");};
    div.ondragleave=()=>div.classList.remove("over");
    div.ondrop=(e)=>{
      e.preventDefault();div.classList.remove("over");
      if(!filled[o])filled[o]=0;
      const max=(o.includes("s")?2:o.includes("p")?6:o.includes("d")?10:14);
      if(filled[o]<max){filled[o]++;updateConfigOutput();}
      else{adjustScore(-1);alert("Too many electrons in "+o);}
    };
    grid.appendChild(div);
  });
}

/* ===== Build Periodic Table ===== */
function buildPeriodicGrid(){
  const pt=document.getElementById("ptable");
  pt.innerHTML="";
  for(let i=1;i<=36;i++){
    const b=document.createElement("div");
    b.className="pt-btn";
    const sym=ELEMENTS[i]||"";
    b.textContent=sym;
    if(i<=2||[3,4,11,12,19,20].includes(i))b.classList.add("pt-s");
    else if([5,6,7,8,9,10,13,14,15,16,17,18,31,32,33,34,35,36].includes(i))b.classList.add("pt-p");
    else if(i>=21&&i<=30)b.classList.add("pt-d");
    pt.appendChild(b);
  }
}

/* ===== Noble-gas Prefill Hook ===== */
function noblePrefill(elementZ){
  // find previous noble gas core
  const noble={2:"He",10:"Ne",18:"Ar",36:"Kr"};
  let coreZ=0;
  for(let nz of Object.keys(noble))if(elementZ>nz)coreZ=nz;
  if(coreZ){
    resetBoard();
    let cnt=0;
    for(let o of ORBITAL_ORDER){
      const max=(o.includes("s")?2:o.includes("p")?6:o.includes("d")?10:14);
      filled[o]=max;
      cnt+=max;
      if(cnt>=coreZ)break;
    }
    updateConfigOutput();
  }
}

/* ===== Exception Merge (Cu/Cr) ===== */
function applyExceptions(z){
  if(EXCEPTIONS[z]){
    const ex=EXCEPTIONS[z];
    for(let o in ex){filled[o]=ex[o];}
    updateConfigOutput();
  }
}

/* ===== Main Initialization ===== */
window.addEventListener("load",()=>{
  buildOrbitals();
  buildPeriodicGrid();
});
</script>

</div>
</body>
</html>
